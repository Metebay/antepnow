<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yönetici Paneli | Modern Haber CMS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-slate-100 min-h-screen p-6">

  <div class="max-w-5xl mx-auto">
    <h1 class="text-3xl font-bold text-blue-700 mb-6 text-center">Yönetici Paneli</h1>

    <!-- Haber Formu -->
    <div class="bg-white p-6 rounded-2xl shadow-lg mb-8">
      <h2 class="text-2xl font-semibold mb-4">Haber Ekle / Düzenle</h2>
      <form id="newsForm" class="flex flex-col gap-3" onsubmit="event.preventDefault()">
        <input type="hidden" id="editId">
        <input type="text" id="baslik" placeholder="Başlık" class="p-3 rounded-lg border border-gray-300" required>
        <textarea id="icerik" placeholder="İçerik" rows="5" class="p-3 rounded-lg border border-gray-300" required></textarea>
        <input type="text" id="fotoURL" placeholder="Görsel URL" class="p-3 rounded-lg border border-gray-300">
        <select id="kategori" class="p-3 rounded-lg border border-gray-300">
          <option value="">Kategori Seçin</option>
          <option value="Siyaset">Siyaset</option>
          <option value="Ekonomi">Ekonomi</option>
          <option value="Spor">Spor</option>
          <option value="Teknoloji">Teknoloji</option>
        </select>
        <button id="submitBtn" type="submit" class="bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600 transition">Haberi Yayınla</button>
      </form>
    </div>

    <!-- Mevcut Haberler -->
    <div class="bg-white p-6 rounded-2xl shadow-lg">
      <h2 class="text-2xl font-semibold mb-4">Mevcut Haberler</h2>
      <div id="haberListesiAdmin" class="flex flex-col gap-3">
        <p class="text-gray-500">Haberler yükleniyor...</p>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp, getDocs, deleteDoc, doc, updateDoc, orderBy, query } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAHDgrgdHzZ2UMzW6fdZTOxQ_xA4MiX3o8",
      authDomain: "habersitesi-154d6.firebaseapp.com",
      projectId: "habersitesi-154d6",
      storageBucket: "habersitesi-154d6.firebasestorage.app",
      messagingSenderId: "739656775591",
      appId: "1:739656775591:web:4ffebd7a3963f3cf66a882",
      measurementId: "G-G3BVBZCD32"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const newsForm = document.getElementById("newsForm");
    const haberListesiAdmin = document.getElementById("haberListesiAdmin");
    const submitBtn = document.getElementById("submitBtn");

    async function haberleriGetir() {
      const q = query(collection(db, "haberler"), orderBy("tarih", "desc"));
      const snapshot = await getDocs(q);
      const haberler = [];
      snapshot.forEach(doc => haberler.push({ id: doc.id, ...doc.data() }));
      renderHaberler(haberler);
    }

    function renderHaberler(list) {
      haberListesiAdmin.innerHTML = "";
      if (!list.length) {
        haberListesiAdmin.innerHTML = `<p class="text-gray-500">Henüz haber yok.</p>`;
        return;
      }

      list.forEach(h => {
        const tarih = h.tarih?.toDate().toLocaleString("tr-TR") || "Tarih yok";
        const div = document.createElement("div");
        div.className = "flex justify-between items-center bg-gray-50 p-3 rounded-lg shadow-sm";

        div.innerHTML = `
          <div class="flex-1">
            <p class="font-bold">${h.baslik} ${h.kategori ? '('+h.kategori+')' : ''}</p>
            <p class="text-sm text-gray-500">${tarih}</p>
          </div>
          <div class="flex gap-2">
            <button class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600" onclick="duzenle('${h.id}')">Düzenle</button>
            <button class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600" onclick="sil('${h.id}')">Sil</button>
          </div>
        `;
        haberListesiAdmin.appendChild(div);
      });
    }

    async function sil(id) {
      if (confirm("Bu haberi silmek istediğinizden emin misiniz?")) {
        await deleteDoc(doc(db, "haberler", id));
        haberleriGetir();
      }
    }

    window.duzenle = async function(id) {
      const docRef = doc(db, "haberler", id);
      const snapshot = await getDocs(collection(db, "haberler"));
      const haberSnap = await docRef.get ? await docRef.get() : await getDoc(docRef);
      const h = haberSnap.data();

      document.getElementById("baslik").value = h.baslik;
      document.getElementById("icerik").value = h.icerik;
      document.getElementById("fotoURL").value = h.fotoURL || "";
      document.getElementById("kategori").value = h.kategori || "";
      document.getElementById("editId").value = id;
      submitBtn.textContent = "Haberi Güncelle";
    }

    newsForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const baslik = document.getElementById("baslik").value;
      const icerik = document.getElementById("icerik").value;
      const fotoURL = document.getElementById("fotoURL").value;
      const kategori = document.getElementById("kategori").value;
      const editId = document.getElementById("editId").value;

      const data = { baslik, icerik, fotoURL, kategori, tarih: serverTimestamp() };

      if (editId) {
        await updateDoc(doc(db, "haberler", editId), data);
        submitBtn.textContent = "Haberi Yayınla";
        document.getElementById("editId").value = "";
      } else {
        await addDoc(collection(db, "haberler"), data);
      }

      newsForm.reset();
      haberleriGetir();
    });

    haberleriGetir();
  </script>
</body>
</html>
