<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hızlı Haber</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
.line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
.category-btn { transition: all 0.2s; }
.category-btn:hover { background-color: #ef4444; color: #fff; }
</style>
</head>
<body class="min-h-screen">

<!-- Header -->
<header class="bg-white shadow-md p-4 sticky top-0 z-10 flex justify-between items-center">
  <h1 class="text-3xl font-extrabold text-gray-900 cursor-pointer" onclick="window.location.hash='#home'">
    <span class="text-red-600">Hızlı</span> Haber
  </h1>
  <nav>
    <button id="nav-home" class="text-gray-700 hover:text-red-600 font-medium mr-4" onclick="window.location.hash='#home'">Ana Sayfa</button>
    <button id="nav-admin" class="text-gray-700 hover:text-red-600 font-medium" onclick="window.location.hash='#admin'">Yönetim Paneli</button>
  </nav>
</header>

<!-- İçerik -->
<div id="content" class="max-w-6xl mx-auto p-4 sm:p-6 lg:p-8"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getFirestore, collection, getDocs, query, orderBy, doc, setDoc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";

// Firebase yapılandırma
const firebaseConfig = {
  apiKey: "AIzaSyAHDgrgdHzZ2UMzW6fdZTOxQ_xA4MiX3o8",
  authDomain: "habersitesi-154d6.firebaseapp.com",
  projectId: "habersitesi-154d6",
  storageBucket: "habersitesi-154d6.firebasestorage.app",
  messagingSenderId: "739656775591",
  appId: "1:739656775591:web:4ffebd7a3963f3cf66a882",
  measurementId: "G-G3BVBZCD32"
};

// Firebase başlat
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let currentUser = null;
let tumHaberler = [];

onAuthStateChanged(auth, user => {
  currentUser = user;
  render();
});

// Haberleri getir
async function fetchNews() {
  const q = query(collection(db, "haberler"), orderBy("tarih", "desc"));
  const snapshot = await getDocs(q);
  tumHaberler = [];
  snapshot.forEach(doc => tumHaberler.push({ id: doc.id, ...doc.data() }));
}

// Admin login
async function loginAdmin(email, password) {
  try {
    await signInWithEmailAndPassword(auth, email, password);
    alert("Giriş başarılı!");
    render();
  } catch(err) {
    alert("Giriş hatası: " + err.message);
  }
}

// Admin logout
function logoutAdmin() {
  signOut(auth);
  alert("Oturum kapatıldı.");
  render();
}

// Haber ekleme/güncelleme
async function publishNews(title, content, imageURL = '', kategori = '', docId = null) {
  if (!currentUser) { alert("Admin yetkisi gerekli."); return; }
  const data = {
    baslik: title,
    icerik: content,
    fotoURL: imageURL || "https://placehold.co/600x400/e0e0e0/333333?text=Gorsel+Yok",
    kategori: kategori,
    tarih: serverTimestamp()
  };
  try {
    if (docId) {
      await setDoc(doc(db, "haberler", docId), data, { merge: true });
    } else {
      const newDoc = doc(collection(db, "haberler"));
      await setDoc(newDoc, data);
    }
    alert("Haber kaydedildi!");
    render();
  } catch(err) { alert("Haber kaydı hatası: " + err.message); }
}

// Haber silme
async function deleteNewsItem(docId) {
  if (!currentUser) { alert("Admin yetkisi gerekli."); return; }
  try {
    await deleteDoc(doc(db, "haberler", docId));
    alert("Haber silindi!");
    render();
  } catch(err) { alert("Silme hatası: " + err.message); }
}

// Render fonksiyonu
async function render() {
  const hash = window.location.hash || "#home";
  const content = document.getElementById("content");
  await fetchNews();

  if (hash === "#admin") {
    if (!currentUser) {
      content.innerHTML = `
        <div class="max-w-md mx-auto bg-white p-8 shadow-xl rounded-xl mt-10">
          <h2 class="text-3xl font-bold text-red-600 mb-6 text-center">Admin Girişi</h2>
          <input id="adminEmail" placeholder="Email" class="border p-2 mb-2 w-full"/>
          <input id="adminPass" type="password" placeholder="Şifre" class="border p-2 mb-4 w-full"/>
          <button onclick="loginAdmin(document.getElementById('adminEmail').value, document.getElementById('adminPass').value)" class="bg-red-500 text-white px-4 py-2 rounded w-full">Giriş</button>
        </div>
      `;
      return;
    }

    let haberForm = `
      <div class="bg-white p-6 rounded-xl shadow-xl mb-6">
        <h2 class="font-bold text-2xl mb-4">Haber Oluştur/Düzenle</h2>
        <input id="newsTitle" placeholder="Başlık" class="border p-2 mb-2 w-full"/>
        <textarea id="newsContent" placeholder="İçerik" class="border p-2 mb-2 w-full"></textarea>
        <input id="newsImage" placeholder="Görsel URL" class="border p-2 mb-2 w-full"/>
        <input id="newsKategori" placeholder="Kategori" class="border p-2 mb-2 w-full"/>
        <button onclick="publishNews(document.getElementById('newsTitle').value, document.getElementById('newsContent').value, document.getElementById('newsImage').value, document.getElementById('newsKategori').value)" class="bg-red-500 text-white px-4 py-2 rounded w-full">Yayınla</button>
        <button onclick="logoutAdmin()" class="bg-gray-500 text-white px-4 py-2 rounded w-full mt-2">Çıkış</button>
      </div>
    `;

    let haberList = tumHaberler.map(h => `
      <div class="bg-white p-4 rounded-xl shadow mb-3 flex justify-between items-center">
        <div>
          <p class="font-bold">${h.baslik}</p>
          <p class="text-sm text-gray-500">${h.kategori || ""} | ${h.tarih?.toDate().toLocaleDateString("tr-TR") || ""}</p>
        </div>
        <div class="flex gap-2">
          <button onclick="publishNews('${h.baslik}','${h.icerik}','${h.fotoURL}','${h.kategori}','${h.id}')" class="px-3 py-1 bg-blue-500 text-white rounded">Düzenle</button>
          <button onclick="deleteNewsItem('${h.id}')" class="px-3 py-1 bg-red-500 text-white rounded">Sil</button>
        </div>
      </div>
    `).join('');

    content.innerHTML = haberForm + `<h2 class="font-bold text-2xl mb-4">Mevcut Haberler</h2>` + haberList;
  } else {
    // Ana Sayfa
    let haberHtml = tumHaberler.map(h => `
      <div class="bg-white shadow-md rounded-xl overflow-hidden p-4 mb-4 flex flex-col lg:flex-row">
        <div class="lg:w-1/3 h-48 overflow-hidden">
          <img src="${h.fotoURL}" class="w-full h-full object-cover" />
        </div>
        <div class="lg:w-2/3 p-4 flex flex-col justify-between">
          <h3 class="font-bold text-xl mb-2">${h.baslik}</h3>
          <p class="text-gray-600 line-clamp-3">${h.icerik}</p>
          <p class="text-sm text-gray-400 mt-2">${h.tarih?.toDate().toLocaleDateString("tr-TR") || ""} ${h.kategori ? "| " + h.kategori : ""}</p>
        </div>
      </div>
    `).join('');

    content.innerHTML = `<h2 class="font-bold text-2xl mb-4">Son Haberler</h2>` + haberHtml;
  }

  // Nav renk güncelle
  document.getElementById("nav-home").classList.toggle("text-red-600", hash === "#home");
  document.getElementById("nav-admin").classList.toggle("text-red-600", hash === "#admin");
}

window.addEventListener("hashchange", render);
window.render = render;
render();
</script>

</body>
</html>
